<!DOCTYPE html>
<html>
<head>
  <title>Plane Shooter Game</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: black;
    }
    canvas {
      display: block;
      margin: auto;
      background: #000;
    }
  </style>
</head>
<body>
<canvas id="gameCanvas" width="400" height="600"></canvas>
<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

// Load images
const planeImg = new Image();
planeImg.src = "plane.png";

const enemyImg = new Image();
enemyImg.src = "enemy.png";

const bgImg = new Image();
bgImg.src = "background.png";

// Load sounds (MP3 format)
const shootSound = new Audio("shoot.mp3");
const explosionSound = new Audio("explosion.mp3");

// Game state
let gameState = "start"; // start | playing | gameover

// Player and game data
let plane = { x: 180, y: 500, w: 40, h: 40 };
let bullets = [];
let enemies = [];
let score = 0;

// Handle input
document.addEventListener("keydown", e => {
  if (gameState === "start" && e.key === " ") {
    gameState = "playing";
  } else if (gameState === "gameover" && e.key.toLowerCase() === "r") {
    resetGame();
  }

  if (gameState === "playing") {
    if (e.key === "ArrowLeft" && plane.x > 0) plane.x -= 20;
    if (e.key === "ArrowRight" && plane.x < canvas.width - plane.w) plane.x += 20;
    if (e.key === " " || e.key === "ArrowUp") {
      bullets.push({ x: plane.x + plane.w / 2 - 2, y: plane.y });
      shootSound.pause();
      shootSound.currentTime = 0;
      shootSound.play().catch(err => console.log("Shoot sound error:", err));
    }
  }
});

// Reset the game
function resetGame() {
  plane = { x: 180, y: 500, w: 40, h: 40 };
  bullets = [];
  enemies = [];
  score = 0;
  gameState = "start";
}

// Draw functions
function drawBackground() {
  ctx.drawImage(bgImg, 0, 0, canvas.width, canvas.height);
}

function drawPlane() {
  ctx.drawImage(planeImg, plane.x, plane.y, plane.w, plane.h);
}

function drawBullets() {
  ctx.fillStyle = "red";
  bullets.forEach(b => {
    b.y -= 10;
    ctx.fillRect(b.x, b.y, 4, 10);
  });
  bullets = bullets.filter(b => b.y > -10);
}

function drawEnemies() {
  if (Math.random() < 0.02) {
    enemies.push({ x: Math.random() * (canvas.width - 40), y: -40 });
  }
  enemies.forEach(e => {
    e.y += 3;
    ctx.drawImage(enemyImg, e.x, e.y, 40, 40);
  });
  enemies = enemies.filter(e => e.y < canvas.height + 40);
}

function checkCollisions() {
  for (let i = enemies.length - 1; i >= 0; i--) {
    for (let j = bullets.length - 1; j >= 0; j--) {
      const e = enemies[i];
      const b = bullets[j];
      if (
        b.x < e.x + 40 &&
        b.x + 4 > e.x &&
        b.y < e.y + 40 &&
        b.y + 10 > e.y
      ) {
        enemies.splice(i, 1);
        bullets.splice(j, 1);
        score++;
        explosionSound.pause();
        explosionSound.currentTime = 0;
        explosionSound.play().catch(err => console.log("Explosion sound error:", err));
        break;
      }
    }
  }
}

function checkGameOver() {
  for (let e of enemies) {
    if (e.y + 40 >= plane.y) {
      gameState = "gameover";
    }
  }
}

function drawScore() {
  ctx.fillStyle = "white";
  ctx.font = "20px Arial";
  ctx.fillText("Score: " + score, 10, 30);
}

function drawStartScreen() {
  ctx.fillStyle = "black";
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = "white";
  ctx.font = "28px Arial";
  ctx.fillText("Arcade Plane Shooter", 50, 250);
  ctx.font = "20px Arial";
  ctx.fillText("Press SPACE to start", 100, 300);
}

function drawGameOver() {
  ctx.fillStyle = "rgba(0, 0, 0, 0.7)";
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = "red";
  ctx.font = "32px Arial";
  ctx.fillText("Game Over", 110, 250);
  ctx.fillStyle = "white";
  ctx.font = "20px Arial";
  ctx.fillText("Score: " + score, 150, 300);
  ctx.fillText("Press R to restart", 120, 350);
}

// Game loop
function gameLoop() {
  if (gameState === "start") {
    drawStartScreen();
  } else if (gameState === "playing") {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawBackground();
    drawPlane();
    drawBullets();
    drawEnemies();
    checkCollisions();
    checkGameOver();
    drawScore();
  } else if (gameState === "gameover") {
    drawGameOver();
  }
  requestAnimationFrame(gameLoop);
}

// Start loop
gameLoop();
</script>
</body>
</html>
